我明白了。即使我之前加上了 `api_key.strip()`，但问题依然存在。
而且用户这次提供了一个看起来很长的 Key：`sk-dBCw59NIdtyRyKEIjcUdddV0ktfagO5JhHmXLlP4oZwGSLzd`。
这个 Key 的长度大约是 53 个字符。

报错依然是 `UnicodeEncodeError: 'ascii' codec can't encode characters in position 78-82: ordinal not in range(128)`。

让我们再仔细算一下：
Header 是 `Authorization: Bearer <KEY>`。
`Authorization: `  (15 chars)
`Bearer `  (7 chars)
15 + 7 = 22。
22 + 53 = 75。
如果是这种情况，78-82 已经超出了 Key 的范围。

**但是**，`httpx` 的 `Headers` 是一个字典。`_normalize_header_value` 是对 Value 进行编码。
所以 Value 就是 `Bearer <KEY>`。
`Bearer `  是 7 个字符。
`position 78-82` 意味着 Value 的第 78 个字符左右出错了。
如果 Key 只有 53 个字符，那么 `Bearer `  + Key = 60 个字符。
怎么会到 78 呢？

**除非：**

1. Key 实际上比我看到的要长得多？
2. 或者还有其他的 Header 被设置了，而且那个 Header 有问题？

让我们看看用户提供的 Key：`sk-dBCw59NIdtyRyKEIjcUdddV0ktfagO5JhHmXLlP4oZwGSLzd`
长度：53。
如果这就是全部，那么 `Bearer ...` 长度就是 60。
报错位置 78-82 说明还有大约 18-22 个额外的字符跟在后面。
这极有可能是一些隐藏字符，或者我之前 `strip()` 没有去掉的字符（比如一些特殊的 Unicode 空白符，`strip()` 默认是可以去掉大部分的，但也许有漏网之鱼？）。
或者，用户之前输入的 Key 其实包含了中文，而 Streamlit 的 `session_state` 或 `sidebar` 输入框保留了那个“脏”的 Key，即使我代码里加了 `strip`，如果用户之前输入了很长的脏数据，且 Streamlit 缓存了它？

不，用户这次是想让我把 Key **写死为默认值**。
这是一个很好的调试机会。如果我硬编码一个纯净的 ASCII 字符串作为默认值，那么如果还报错，就说明问题**绝对不在** Key 本身，而是在其他 Header 上。

**其他 Header 嫌疑人：**
`User-Agent`? `openai` 库会自动生成 User-Agent。
`OpenAI-Organization`? 我们没设。
`X-Stainless-...`? 这些是库自动生成的。

如果我的电脑用户名是中文，比如 `C:\Users\张三`，那么 `openai` 库在构建 `X-Stainless-Arch` 或 `X-Stainless-Runtime` 时，可能会读取系统信息。
但通常库处理这些比较稳健。

**最大嫌疑人仍然是 Key 的来源。**
也许 Streamlit 的 `text_input` 返回的字符串包含了某种富文本格式的残留？

**行动计划：**

1. **硬编码默认 Key**：修改 `app.py`，将 `st.sidebar.text_input` 的 `value` 默认为用户提供的那个长 Key。
2. **强制 ASCII 转换**：在 `src/agentscope_adapter.py` 中，不仅仅是 `strip()`，我要强制把 Key 转换为 ASCII，忽略任何非 ASCII 字符。

   ```python
   api_key = api_key.encode('ascii', 'ignore').decode('ascii').strip()
   ```

   这样可以物理上剔除任何“幽灵”字符。
3. **打印 Header 调试信息**（如果可能）：虽然我不能直接修改库代码，但我可以在 `src/agentscope_adapter.py` 里打印处理后的 Key 的长度和 repr，确认它是否真的干净。

**为什么修改了多次还是报错？**

1. 第一次是因为 `agentscope.manager` 不存在。
2. 第二次是因为 `stream=True` 返回了生成器，而代码当作对象处理。
3. 第三次（刚才）是因为 `api_key` 里有非 ASCII 字符，虽然我加了 `strip()`，但可能没生效（比如用户没有刷新页面，或者 `strip` 没去掉中间的字符，或者字符在 Key 的*中间*？）。

   * 报错说 `position 78-82`。如果 Key 只有 53 字符，那说明 Key 后面跟了 20 多个字符。`strip()` 应该能去掉。

   * 除非……那个 Key 本身就是坏的？或者用户复制的时候带了很长的尾巴？

让我们执行计划。

Plan:

1. Update `app.py`: Set default value for API Key input.
2. Update `src/agentscope_adapter.py`: Aggressively sanitize API Key (encode/decode ascii ignore).

